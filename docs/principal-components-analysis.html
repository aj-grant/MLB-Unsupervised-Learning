<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Principal components analysis | Machine Learning for Biostatistics</title>
  <meta name="description" content="1 Principal components analysis | Machine Learning for Biostatistics" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Principal components analysis | Machine Learning for Biostatistics" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Principal components analysis | Machine Learning for Biostatistics" />
  
  
  

<meta name="author" content="Armando Teixeira-Pinto, Jaroslaw Harezlak &amp; Andrew Grant" />


<meta name="date" content="2025-09-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="k-means-clustering.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><center><img src="bca.png"><H3><b><font color="F26531"> Machine Learning for Biostatistics </font> </b></H3> <a href="https://canvas.sydney.edu.au/courses/66692/modules" style="color:364550" target="blank"><small><i> Back to canvas website </i></small></a></center></li>
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Unsupervised Learning</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#dataset-used-in-the-examples"><i class="fa fa-check"></i>Dataset used in the examples</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#slides-from-the-videos"><i class="fa fa-check"></i>Slides from the videos</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html"><i class="fa fa-check"></i><b>1</b> Principal components analysis</a>
<ul>
<li class="chapter" data-level="1.1" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#PCA1"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#PCA2"><i class="fa fa-check"></i><b>1.2</b> Readings</a></li>
<li class="chapter" data-level="1.3" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#PCA3"><i class="fa fa-check"></i><b>1.3</b> Practice session</a>
<ul>
<li class="chapter" data-level="" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#task-1---identify-the-principal-components"><i class="fa fa-check"></i>Task 1 - Identify the principal components</a></li>
<li class="chapter" data-level="" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#task-2---use-pca-in-a-prediction-model"><i class="fa fa-check"></i>Task 2 - Use PCA in a prediction model</a></li>
<li class="chapter" data-level="" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#task-3---use-pca-to-compress-an-image"><i class="fa fa-check"></i>Task 3 - Use PCA to compress an image</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#PCA4"><i class="fa fa-check"></i><b>1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="k-means-clustering.html"><a href="k-means-clustering.html"><i class="fa fa-check"></i><b>2</b> K-means clustering</a>
<ul>
<li class="chapter" data-level="2.1" data-path="k-means-clustering.html"><a href="k-means-clustering.html#KM1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="k-means-clustering.html"><a href="k-means-clustering.html#KM2"><i class="fa fa-check"></i><b>2.2</b> Readings</a></li>
<li class="chapter" data-level="2.3" data-path="k-means-clustering.html"><a href="k-means-clustering.html#KM3"><i class="fa fa-check"></i><b>2.3</b> Practice session</a>
<ul>
<li class="chapter" data-level="" data-path="k-means-clustering.html"><a href="k-means-clustering.html#task-1---identify-k-clusters"><i class="fa fa-check"></i>Task 1 - Identify k clusters</a></li>
<li class="chapter" data-level="" data-path="k-means-clustering.html"><a href="k-means-clustering.html#task-2---choosing-the-number-of-clusters"><i class="fa fa-check"></i>Task 2 - Choosing the number of clusters</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="k-means-clustering.html"><a href="k-means-clustering.html#KM4"><i class="fa fa-check"></i><b>2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html"><i class="fa fa-check"></i><b>3</b> Hierarchical Clustering</a>
<ul>
<li class="chapter" data-level="3.1" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#HC1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#HC2"><i class="fa fa-check"></i><b>3.2</b> Readings</a></li>
<li class="chapter" data-level="3.3" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#HC3"><i class="fa fa-check"></i><b>3.3</b> Practice session</a>
<ul>
<li class="chapter" data-level="" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#task-1---identify-clusters"><i class="fa fa-check"></i>Task 1 - Identify clusters</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#HC4"><i class="fa fa-check"></i><b>3.4</b> Exercises</a></li>
</ul></li>
<li class="divider"></li>
<li><center><a href="https://canvas.sydney.edu.au/courses/66692/modules" style="color:364550" target="blank"><img src="usyd2.gif" width="60%"></a> <small>© A.Teixeira-Pinto, University of Sydney, 2021</small></center></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Machine Learning for Biostatistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="principal-components-analysis" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> Principal components analysis<a href="principal-components-analysis.html#principal-components-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="PCA1" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Introduction<a href="principal-components-analysis.html#PCA1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Principal components analysis (PCA) is a data reduction (also referred to as
dimension reduction) technique. Given a
large set of variables, PCA identifies a small number of linear combinations
(components) that retain most of the information of the variables.</p>
<p>Suppose we have <span class="math inline">\(p\)</span> variables <span class="math inline">\(x_1,...,x_p\)</span>. A PCA analysis would identify,
<span class="math inline">\(z_1,z_2,...\)</span> components that are linear combinations of the original variables,
<span class="math display">\[
\begin{aligned}
z_1 = \phi_{11}x_1 + &amp;\phi_{21}x_2 +... + \phi_{p1}x_p\\
z_2 = \phi_{12}x_1 + &amp;\phi_{22}x_2 +... + \phi_{p2}x_p\\
z_3 = \phi_{13}x_1 + &amp;\phi_{23}x_2 +... + \phi_{p3}x_p\\
\vdots
\end{aligned}
\]</span></p>
<p>We will have up to <span class="math inline">\(p\)</span> components (unless the number of observations is less
than <span class="math inline">\(p\)</span>), but hopefully the first components will explain most of the
information and we can discard the others. This is why PCA is called a data
reduction method. There are two extreme situations: all the variables were
completely independent and in this case, the number of “important” components
would be the same as the number of variables, or all the variable are
perfectly correlated so 1 component would retain all the information.</p>
<p>For simplicity, let’s assume that variables <span class="math inline">\(x_1,...,x_p\)</span> are scaled to have
standard deviation 1 and mean 0. For the first component,</p>
<p><span class="math display">\[
z_1 = \phi_{11}x_1 + \phi_{21}x_2 +... + \phi_{p1}x_p\\
\]</span></p>
<p>we need to find the
<strong>component loading vector</strong> <span class="math inline">\((\phi_{11}, \phi_{21},... \phi_{p1})\)</span> that
has the largest variance. We want to constrain <span class="math inline">\(\sum_{j1}^{p}{\phi^2_{j1}=1}\)</span>
otherwise the variance would increase just by increasing the magnitude of the
<span class="math inline">\(\phi_{j1}\)</span>’s.</p>
<p>Formally, we want to find the loading vector that <span class="math inline">\(\text{maximises }  var(z_1)\)</span>
subject to <span class="math inline">\(\sum_{j1}^{p}{\phi^2_{j1}=1}\)</span>.
Given that <span class="math inline">\(z_1\)</span> has mean zero,</p>
<p><span class="math display">\[
\begin{aligned}
\text{maximise }  var(z_1) &amp;= \text{maximise }  \frac{1}{n}\sum_{i=1}^{n}z^2_{ij} \\
&amp;= \text{maximise }  \frac{1}{n}\sum_{i=1}^{n} \left(\sum_{j=1}^{p}\phi_{j1}x_{ij}. \right)^2
\end{aligned}
\]</span></p>
<p>Geometrically the <span class="math inline">\(z_1\)</span> is a projection of the vectors <span class="math inline">\(x_1,...,x_p\)</span> into a
real line. We want this projection to have the direction that
maximises the variance. Consider the figure below representing only
2 variables <span class="math inline">\(x_1,x_2\)</span>. The first
component, is the line where the projected points have higher dispersion
(variance). The points projected on the line in the right, show a higher
variance than the one in the left.</p>
<p><img src="pca.png" />
<a href="pca.gif"></a></p>
<p>Once we have found the first component, the next ones are found in a similar
fashion but with the additional requirement of orthogonality, i.e., the
components need to be independent of each other (orthogonal).</p>
<p>The solution for the maximisation problem above is found using eigen
decomposition where the eigenvectors are the
components of the PCA.
<!-- (if you are interested in the mathematical details, you  -->
<!-- can find some more information in the  -->
<!-- [optional readings ](https://towardsdatascience.com/the-mathematics-behind-principal-component-analysis-fff2d7f4b643)). --></p>
<p>PCA can be used to see how variables get “clustered” together into the
components and how groups are characterised in terms of the components. More
commonly, PCA is used as a <strong>pre-processing</strong> step to reduce the dimensionality
of the data and then the main components are used in a classification or
regression algorithm.</p>
<p>The following is an <strong>external video</strong> produced by Dr. Josh Starmer, creator
of the channel StatQuest. It gives a simple overview of the geometrical
construction of the PCA that might be useful before you do the readings.</p>
<iframe width="784" height="441" src="https://www.youtube.com/embed/FgakZw6K1QQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
</div>
<div id="PCA2" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Readings<a href="principal-components-analysis.html#PCA2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Read the following chapters of <em>An introduction to statistical learning</em>:</p>
<ul>
<li>6.3 Dimension Reduction Methods - excluding 6.3.2</li>
<li>12.2 Principal Components Analysis</li>
</ul>
</div>
<div id="PCA3" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Practice session<a href="principal-components-analysis.html#PCA3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="task-1---identify-the-principal-components" class="section level3 unnumbered hasAnchor">
<h3>Task 1 - Identify the principal components<a href="principal-components-analysis.html#task-1---identify-the-principal-components" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using the <a href="https://www.dropbox.com/s/vp44yozebx5xgok/bdiag.csv?dl=1">bdiag.csv</a>, let’s run a PCA for several characteristics of cells.
…</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="principal-components-analysis.html#cb1-1" tabindex="-1"></a><span class="co">#libraries that we will need</span></span>
<span id="cb1-2"><a href="principal-components-analysis.html#cb1-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1974</span>) <span class="co">#fix the random generator seed </span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="principal-components-analysis.html#cb2-1" tabindex="-1"></a><span class="co">#read the dataset</span></span>
<span id="cb2-2"><a href="principal-components-analysis.html#cb2-2" tabindex="-1"></a>bdiag.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://www.dropbox.com/s/fvj7774lmyneab6/bdiag.csv?dl=1&quot;</span>, </span>
<span id="cb2-3"><a href="principal-components-analysis.html#cb2-3" tabindex="-1"></a>           <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-4"><a href="principal-components-analysis.html#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="principal-components-analysis.html#cb2-5" tabindex="-1"></a>bdiag.pca.data <span class="ot">&lt;-</span> bdiag.data[,<span class="fu">c</span>(<span class="st">&quot;radius_mean&quot;</span>, <span class="st">&quot;texture_mean&quot;</span>, </span>
<span id="cb2-6"><a href="principal-components-analysis.html#cb2-6" tabindex="-1"></a><span class="st">&quot;perimeter_mean&quot;</span>, <span class="st">&quot;area_mean&quot;</span>, <span class="st">&quot;smoothness_mean&quot;</span>, <span class="st">&quot;compactness_mean&quot;</span>, </span>
<span id="cb2-7"><a href="principal-components-analysis.html#cb2-7" tabindex="-1"></a><span class="st">&quot;concavity_mean&quot;</span>, <span class="st">&quot;concave.points_mean&quot;</span>, <span class="st">&quot;symmetry_mean&quot;</span>, <span class="st">&quot;fractal_dimension_mean&quot;</span>)]</span>
<span id="cb2-8"><a href="principal-components-analysis.html#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="principal-components-analysis.html#cb2-9" tabindex="-1"></a>bdiag.pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(bdiag.pca.data, <span class="at">scale=</span><span class="cn">TRUE</span>) <span class="co">#pca with scaled variables</span></span></code></pre></div>
<p>The <code>prcomp()</code> function will include in its results</p>
<ul>
<li>sdev - the standard deviations of the principal components</li>
<li>rotation - the matrix of variable loadings for the components</li>
<li>x - the scaled matrix of data times the factor loadings (scores as defined
in the <em>An introduction to statistical learning</em> book, page 500)</li>
</ul>
<p>We now can see how much variance is explained by the components. We will
use some functions of the package <code>factoextra</code> to plot some of the results.
The plot representing the variance explained by the components is called the <em>Scree Plot</em>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="principal-components-analysis.html#cb3-1" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span></code></pre></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## Warning: package &#39;ggplot2&#39; was built under R version 4.3.3</code></pre>
<pre><code>## Welcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="principal-components-analysis.html#cb7-1" tabindex="-1"></a><span class="fu">summary</span>(bdiag.pca) <span class="co">#variance explained</span></span></code></pre></div>
<pre><code>## Importance of components:
##                           PC1    PC2     PC3    PC4     PC5     PC6     PC7
## Standard deviation     2.3406 1.5870 0.93841 0.7064 0.61036 0.35234 0.28299
## Proportion of Variance 0.5479 0.2519 0.08806 0.0499 0.03725 0.01241 0.00801
## Cumulative Proportion  0.5479 0.7997 0.88779 0.9377 0.97495 0.98736 0.99537
##                            PC8     PC9    PC10
## Standard deviation     0.18679 0.10552 0.01680
## Proportion of Variance 0.00349 0.00111 0.00003
## Cumulative Proportion  0.99886 0.99997 1.00000</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="principal-components-analysis.html#cb9-1" tabindex="-1"></a><span class="fu">fviz_eig</span>(bdiag.pca) <span class="co">#scree plot</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>The first 2 components explain approximately 80% of the total variation and
3 components, almost 90%. The
number of components that one wants to retain is problem specific and it is
a trade-off between information and low-dimensionality.</p>
<p>It is also useful to look at the contribution of each variable in the different
components.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="principal-components-analysis.html#cb10-1" tabindex="-1"></a> <span class="co">#loading vectors  </span></span>
<span id="cb10-2"><a href="principal-components-analysis.html#cb10-2" tabindex="-1"></a> <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb10-3"><a href="principal-components-analysis.html#cb10-3" tabindex="-1"></a> <span class="fu">fviz_pca_var</span>(bdiag.pca, <span class="at">col.var =</span> <span class="st">&quot;steelblue&quot;</span>)  <span class="co"># comp 1 vs 2</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="principal-components-analysis.html#cb11-1" tabindex="-1"></a> <span class="fu">fviz_pca_var</span>(bdiag.pca, <span class="at">col.var =</span> <span class="st">&quot;steelblue&quot;</span>,<span class="at">axes=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)) <span class="co"># comp 1 vs 3</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="principal-components-analysis.html#cb12-1" tabindex="-1"></a> <span class="fu">fviz_pca_var</span>(bdiag.pca, <span class="at">col.var =</span> <span class="st">&quot;steelblue&quot;</span>,<span class="at">axes=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)) <span class="co"># comp 2 vs 3</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-4-3.png" width="672" /></p>
<p>We can see in the plot above that among the 3 components,
<strong>fractal_dimension_mean</strong> contributes mostly
to component 2 whereas <strong>e.points_mean</strong> is contributing to component 1.</p>
<p><strong>TRY IT YOURSELF:</strong></p>
<ol style="list-style-type: decimal">
<li>Get the PCA using the <code>eigen()</code> function that computes eigenvectors
and eigenvalues for a matrix.</li>
</ol>
<details>
<summary>
See the solution code
</summary>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="principal-components-analysis.html#cb13-1" tabindex="-1"></a><span class="co">#first scale the data</span></span>
<span id="cb13-2"><a href="principal-components-analysis.html#cb13-2" tabindex="-1"></a>bdiag.scaled <span class="ot">&lt;-</span> <span class="fu">apply</span>(bdiag.pca.data, <span class="dv">2</span>, scale) <span class="co">#apply scale to columns</span></span>
<span id="cb13-3"><a href="principal-components-analysis.html#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="principal-components-analysis.html#cb13-4" tabindex="-1"></a><span class="co">#get the covariance matrix</span></span>
<span id="cb13-5"><a href="principal-components-analysis.html#cb13-5" tabindex="-1"></a>cov.bdiag <span class="ot">&lt;-</span> <span class="fu">cov</span>(bdiag.scaled)</span>
<span id="cb13-6"><a href="principal-components-analysis.html#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="principal-components-analysis.html#cb13-7" tabindex="-1"></a><span class="co">#Get the eigenvalues and eigenvectors </span></span>
<span id="cb13-8"><a href="principal-components-analysis.html#cb13-8" tabindex="-1"></a><span class="co">#of the covariance matrix</span></span>
<span id="cb13-9"><a href="principal-components-analysis.html#cb13-9" tabindex="-1"></a>ev.bdiag <span class="ot">&lt;-</span> <span class="fu">eigen</span>(cov.bdiag)</span>
<span id="cb13-10"><a href="principal-components-analysis.html#cb13-10" tabindex="-1"></a></span>
<span id="cb13-11"><a href="principal-components-analysis.html#cb13-11" tabindex="-1"></a><span class="co">#The sqrt of the eigenvalues are the std</span></span>
<span id="cb13-12"><a href="principal-components-analysis.html#cb13-12" tabindex="-1"></a><span class="co">#deviations of the compontents </span></span>
<span id="cb13-13"><a href="principal-components-analysis.html#cb13-13" tabindex="-1"></a><span class="fu">sqrt</span>(ev.bdiag<span class="sc">$</span>values)  <span class="co">#equal to bdiag.pca$sdev</span></span>
<span id="cb13-14"><a href="principal-components-analysis.html#cb13-14" tabindex="-1"></a></span>
<span id="cb13-15"><a href="principal-components-analysis.html#cb13-15" tabindex="-1"></a><span class="co">#And the eigenvectors are the principal components.</span></span>
<span id="cb13-16"><a href="principal-components-analysis.html#cb13-16" tabindex="-1"></a>ev.bdiag<span class="sc">$</span>vector      <span class="co">#equal to bdiag.pca$rotation (up to the sign)</span></span></code></pre></div>
</details>
<p>
<p>
</div>
<div id="task-2---use-pca-in-a-prediction-model" class="section level3 unnumbered hasAnchor">
<h3>Task 2 - Use PCA in a prediction model<a href="principal-components-analysis.html#task-2---use-pca-in-a-prediction-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will continue from Task 1 and use some of the principal components
as predictors in a logistic
model for the variable <strong>diagnosis</strong>.</p>
<p>The figure below shows the separations of the two diagnoses groups <em>B</em> and <em>M</em>
in terms of the the principal components.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="principal-components-analysis.html#cb14-1" tabindex="-1"></a>  groups  <span class="ot">&lt;-</span>  bdiag.data<span class="sc">$</span>diagnosis</span>
<span id="cb14-2"><a href="principal-components-analysis.html#cb14-2" tabindex="-1"></a>  <span class="fu">fviz_pca_ind</span>(bdiag.pca,</span>
<span id="cb14-3"><a href="principal-components-analysis.html#cb14-3" tabindex="-1"></a>             <span class="at">col.ind =</span> groups, <span class="co"># color by groups</span></span>
<span id="cb14-4"><a href="principal-components-analysis.html#cb14-4" tabindex="-1"></a>             <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">&quot;#00AFBB&quot;</span>,  <span class="st">&quot;#FC4E07&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>),</span>
<span id="cb14-5"><a href="principal-components-analysis.html#cb14-5" tabindex="-1"></a>             <span class="at">addEllipses =</span> <span class="cn">TRUE</span>, <span class="co"># Concentration ellipses</span></span>
<span id="cb14-6"><a href="principal-components-analysis.html#cb14-6" tabindex="-1"></a>             <span class="at">ellipse.type =</span> <span class="st">&quot;confidence&quot;</span>,</span>
<span id="cb14-7"><a href="principal-components-analysis.html#cb14-7" tabindex="-1"></a>             <span class="at">legend.title =</span> <span class="st">&quot;Groups&quot;</span>,</span>
<span id="cb14-8"><a href="principal-components-analysis.html#cb14-8" tabindex="-1"></a>             <span class="at">repel =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-9"><a href="principal-components-analysis.html#cb14-9" tabindex="-1"></a>             <span class="at">label=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb14-10"><a href="principal-components-analysis.html#cb14-10" tabindex="-1"></a>             <span class="at">axes=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb14-11"><a href="principal-components-analysis.html#cb14-11" tabindex="-1"></a>             )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The package <code>caret</code> includes PCA as a pre-processing option. We will use 3
principal components to predict diagnosis</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="principal-components-analysis.html#cb15-1" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code></pre></div>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;future&#39;:
##   method               from      
##   all.equal.connection parallelly</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="principal-components-analysis.html#cb18-1" tabindex="-1"></a>trctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;repeatedcv&quot;</span>, </span>
<span id="cb18-2"><a href="principal-components-analysis.html#cb18-2" tabindex="-1"></a>                       <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb18-3"><a href="principal-components-analysis.html#cb18-3" tabindex="-1"></a>                       <span class="at">preProcOptions =</span><span class="fu">list</span>(<span class="at">pcaComp =</span> <span class="dv">3</span>),  <span class="co">#or list(thresh = 0.99),</span></span>
<span id="cb18-4"><a href="principal-components-analysis.html#cb18-4" tabindex="-1"></a>                       <span class="at">classProbs =</span> <span class="cn">TRUE</span>,  </span>
<span id="cb18-5"><a href="principal-components-analysis.html#cb18-5" tabindex="-1"></a>                       <span class="at">summaryFunction =</span> twoClassSummary)</span>
<span id="cb18-6"><a href="principal-components-analysis.html#cb18-6" tabindex="-1"></a></span>
<span id="cb18-7"><a href="principal-components-analysis.html#cb18-7" tabindex="-1"></a>bdiag.glm <span class="ot">&lt;-</span> <span class="fu">train</span>(diagnosis <span class="sc">~</span> radius_mean <span class="sc">+</span> texture_mean <span class="sc">+</span> </span>
<span id="cb18-8"><a href="principal-components-analysis.html#cb18-8" tabindex="-1"></a>                     perimeter_mean <span class="sc">+</span> area_mean <span class="sc">+</span> </span>
<span id="cb18-9"><a href="principal-components-analysis.html#cb18-9" tabindex="-1"></a>                     smoothness_mean <span class="sc">+</span> compactness_mean <span class="sc">+</span> </span>
<span id="cb18-10"><a href="principal-components-analysis.html#cb18-10" tabindex="-1"></a>                     concavity_mean <span class="sc">+</span> concave.points_mean <span class="sc">+</span> </span>
<span id="cb18-11"><a href="principal-components-analysis.html#cb18-11" tabindex="-1"></a>                     symmetry_mean <span class="sc">+</span> fractal_dimension_mean,</span>
<span id="cb18-12"><a href="principal-components-analysis.html#cb18-12" tabindex="-1"></a>                   <span class="at">data =</span> bdiag.data,</span>
<span id="cb18-13"><a href="principal-components-analysis.html#cb18-13" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb18-14"><a href="principal-components-analysis.html#cb18-14" tabindex="-1"></a>                   <span class="at">family=</span>binomial,</span>
<span id="cb18-15"><a href="principal-components-analysis.html#cb18-15" tabindex="-1"></a>                   <span class="at">trControl =</span> trctrl,</span>
<span id="cb18-16"><a href="principal-components-analysis.html#cb18-16" tabindex="-1"></a>                   <span class="at">preProcess=</span><span class="fu">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>, <span class="st">&quot;pca&quot;</span>), <span class="co">#uses PCA</span></span>
<span id="cb18-17"><a href="principal-components-analysis.html#cb18-17" tabindex="-1"></a>                   <span class="at">metric=</span><span class="st">&quot;ROC&quot;</span>)</span>
<span id="cb18-18"><a href="principal-components-analysis.html#cb18-18" tabindex="-1"></a></span>
<span id="cb18-19"><a href="principal-components-analysis.html#cb18-19" tabindex="-1"></a>bdiag.glm</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 569 samples
##  10 predictor
##   2 classes: &#39;B&#39;, &#39;M&#39; 
## 
## Pre-processing: centered (10), scaled (10), principal component
##  signal extraction (10) 
## Resampling: Cross-Validated (10 fold, repeated 1 times) 
## Summary of sample sizes: 512, 512, 512, 512, 512, 513, ... 
## Resampling results:
## 
##   ROC        Sens       Spec     
##   0.9834474  0.9605556  0.8863636</code></pre>
<p>The prediction accuracy is excellent with three components. We can get the
coefficients for these components but they don’t have an obvious interpretation.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="principal-components-analysis.html#cb20-1" tabindex="-1"></a><span class="fu">summary</span>(bdiag.glm)</span></code></pre></div>
<pre><code>## 
## Call:
## NULL
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -0.5911     0.2022  -2.923  0.00347 ** 
## PC1          -2.7029     0.2882  -9.379  &lt; 2e-16 ***
## PC2           0.8271     0.1509   5.481 4.22e-08 ***
## PC3           0.7430     0.2144   3.465  0.00053 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 751.44  on 568  degrees of freedom
## Residual deviance: 172.10  on 565  degrees of freedom
## AIC: 180.1
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<p>And the principal components matrix:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="principal-components-analysis.html#cb22-1" tabindex="-1"></a>bdiag.glm<span class="sc">$</span>preProcess<span class="sc">$</span>rotation</span></code></pre></div>
<pre><code>##                                PC1          PC2         PC3
## radius_mean            -0.36393793  0.313929073 -0.12442759
## texture_mean           -0.15445113  0.147180909  0.95105659
## perimeter_mean         -0.37604434  0.284657885 -0.11408360
## area_mean              -0.36408585  0.304841714 -0.12337786
## smoothness_mean        -0.23248053 -0.401962324 -0.16653247
## compactness_mean       -0.36444206 -0.266013147  0.05827786
## concavity_mean         -0.39574849 -0.104285968  0.04114649
## concave.points_mean    -0.41803840 -0.007183605 -0.06855383
## symmetry_mean          -0.21523797 -0.368300910  0.03672364
## fractal_dimension_mean -0.07183744 -0.571767700  0.11358395</code></pre>
<p><strong>TRY IT YOURSELF:</strong></p>
<ol style="list-style-type: decimal">
<li>Fit a random forest to predict <strong>diagnosis</strong> using 7 principal components and
cross-validating the number of variables used in each split.</li>
</ol>
<details>
<summary>
See the solution code
</summary>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="principal-components-analysis.html#cb24-1" tabindex="-1"></a>trctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;repeatedcv&quot;</span>, </span>
<span id="cb24-2"><a href="principal-components-analysis.html#cb24-2" tabindex="-1"></a>                       <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb24-3"><a href="principal-components-analysis.html#cb24-3" tabindex="-1"></a>                       <span class="at">preProcOptions =</span><span class="fu">list</span>(<span class="at">pcaComp =</span> <span class="dv">7</span>), </span>
<span id="cb24-4"><a href="principal-components-analysis.html#cb24-4" tabindex="-1"></a>                       <span class="at">classProbs =</span> <span class="cn">TRUE</span>,  </span>
<span id="cb24-5"><a href="principal-components-analysis.html#cb24-5" tabindex="-1"></a>                       <span class="at">summaryFunction =</span> twoClassSummary)</span>
<span id="cb24-6"><a href="principal-components-analysis.html#cb24-6" tabindex="-1"></a></span>
<span id="cb24-7"><a href="principal-components-analysis.html#cb24-7" tabindex="-1"></a>bdiag.rf <span class="ot">&lt;-</span> <span class="fu">train</span>(diagnosis <span class="sc">~</span> radius_mean <span class="sc">+</span> texture_mean <span class="sc">+</span> </span>
<span id="cb24-8"><a href="principal-components-analysis.html#cb24-8" tabindex="-1"></a>                     perimeter_mean <span class="sc">+</span> area_mean <span class="sc">+</span> </span>
<span id="cb24-9"><a href="principal-components-analysis.html#cb24-9" tabindex="-1"></a>                     smoothness_mean <span class="sc">+</span> compactness_mean <span class="sc">+</span> </span>
<span id="cb24-10"><a href="principal-components-analysis.html#cb24-10" tabindex="-1"></a>                     concavity_mean <span class="sc">+</span> concave.points_mean <span class="sc">+</span> </span>
<span id="cb24-11"><a href="principal-components-analysis.html#cb24-11" tabindex="-1"></a>                     symmetry_mean <span class="sc">+</span> fractal_dimension_mean,</span>
<span id="cb24-12"><a href="principal-components-analysis.html#cb24-12" tabindex="-1"></a>                   <span class="at">data =</span> bdiag.data,</span>
<span id="cb24-13"><a href="principal-components-analysis.html#cb24-13" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">&quot;rf&quot;</span>,</span>
<span id="cb24-14"><a href="principal-components-analysis.html#cb24-14" tabindex="-1"></a>                   <span class="at">family=</span>binomial,</span>
<span id="cb24-15"><a href="principal-components-analysis.html#cb24-15" tabindex="-1"></a>                   <span class="at">trControl =</span> trctrl,</span>
<span id="cb24-16"><a href="principal-components-analysis.html#cb24-16" tabindex="-1"></a>                   <span class="at">preProcess=</span><span class="fu">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>, <span class="st">&quot;pca&quot;</span>), <span class="co">#uses PCA</span></span>
<span id="cb24-17"><a href="principal-components-analysis.html#cb24-17" tabindex="-1"></a>                   <span class="at">ntree =</span> <span class="dv">100</span>,</span>
<span id="cb24-18"><a href="principal-components-analysis.html#cb24-18" tabindex="-1"></a>                   <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">mtry =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)),  </span>
<span id="cb24-19"><a href="principal-components-analysis.html#cb24-19" tabindex="-1"></a>                   <span class="at">metric=</span><span class="st">&quot;ROC&quot;</span>)</span>
<span id="cb24-20"><a href="principal-components-analysis.html#cb24-20" tabindex="-1"></a></span>
<span id="cb24-21"><a href="principal-components-analysis.html#cb24-21" tabindex="-1"></a>bdiag.rf</span></code></pre></div>
</details>
<p>
<p>
</div>
<div id="task-3---use-pca-to-compress-an-image" class="section level3 unnumbered hasAnchor">
<h3>Task 3 - Use PCA to compress an image<a href="principal-components-analysis.html#task-3---use-pca-to-compress-an-image" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is not a typical Biostats problem, but it illustrates the idea behind PCA.
Let’s consider an original image <a href="https://www.dropbox.com/s/hruqk3h69p5l458/roo.jpg?dl=1">roo.jpg</a>.
For simplicity we will only use the
green channel information (the original image has 3 channels: red, green
and blue). This will correspond to a black and white image.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="principal-components-analysis.html#cb25-1" tabindex="-1"></a><span class="fu">library</span>(jpeg)</span>
<span id="cb25-2"><a href="principal-components-analysis.html#cb25-2" tabindex="-1"></a><span class="fu">library</span>(graphics)</span>
<span id="cb25-3"><a href="principal-components-analysis.html#cb25-3" tabindex="-1"></a><span class="co">#the jpeg has 3 channels: red,green, blue</span></span>
<span id="cb25-4"><a href="principal-components-analysis.html#cb25-4" tabindex="-1"></a><span class="co">#for simplicity of the example, I am only</span></span>
<span id="cb25-5"><a href="principal-components-analysis.html#cb25-5" tabindex="-1"></a><span class="co">#reading the green channlel</span></span>
<span id="cb25-6"><a href="principal-components-analysis.html#cb25-6" tabindex="-1"></a>roo <span class="ot">&lt;-</span> <span class="fu">readJPEG</span>(<span class="st">&quot;roo.jpg&quot;</span>)[,,<span class="dv">2</span>]</span>
<span id="cb25-7"><a href="principal-components-analysis.html#cb25-7" tabindex="-1"></a></span>
<span id="cb25-8"><a href="principal-components-analysis.html#cb25-8" tabindex="-1"></a><span class="co">#You can have a look at the image</span></span>
<span id="cb25-9"><a href="principal-components-analysis.html#cb25-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span>F, <span class="at">ann=</span>F)</span>
<span id="cb25-10"><a href="principal-components-analysis.html#cb25-10" tabindex="-1"></a><span class="fu">rasterImage</span>(roo, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/roo-original-1.png" width="672" /></p>
<p>An image is a matrix of pixels with values that represent the intensity of the
the pixel, where 0=white and 1=black. In this case, the image is 800x534 pixels
as you can see by the dimension of the matrix.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="principal-components-analysis.html#cb26-1" tabindex="-1"></a><span class="fu">dim</span>(roo)</span></code></pre></div>
<pre><code>## [1] 534 800</code></pre>
<p>As we would expect, there are several places in the photo where columns of
pixels are strongly correlated with adjacent columns:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="principal-components-analysis.html#cb28-1" tabindex="-1"></a><span class="fu">library</span>(gplots)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;gplots&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     lowess</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="principal-components-analysis.html#cb31-1" tabindex="-1"></a><span class="co">#color for the heatmap</span></span>
<span id="cb31-2"><a href="principal-components-analysis.html#cb31-2" tabindex="-1"></a>col.correlation <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;yellow&quot;</span>,<span class="st">&quot;darkgreen&quot;</span>), </span>
<span id="cb31-3"><a href="principal-components-analysis.html#cb31-3" tabindex="-1"></a>                                    <span class="at">space =</span> <span class="st">&quot;rgb&quot;</span>)(<span class="dv">30</span>)</span>
<span id="cb31-4"><a href="principal-components-analysis.html#cb31-4" tabindex="-1"></a><span class="fu">heatmap.2</span>(<span class="fu">cor</span>(roo), </span>
<span id="cb31-5"><a href="principal-components-analysis.html#cb31-5" tabindex="-1"></a>          <span class="at">Rowv =</span> F, <span class="at">Colv =</span> F, </span>
<span id="cb31-6"><a href="principal-components-analysis.html#cb31-6" tabindex="-1"></a>          <span class="at">dendrogram =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb31-7"><a href="principal-components-analysis.html#cb31-7" tabindex="-1"></a>          <span class="at">trace=</span><span class="st">&quot;none&quot;</span>, </span>
<span id="cb31-8"><a href="principal-components-analysis.html#cb31-8" tabindex="-1"></a>          <span class="at">col=</span>col.correlation)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Therefore, PCA we should be able to reduce the original dimension (800x534)
while keeping a substantial part of the information.</p>
<p>Out of the 534 components, the first
10 components produce the following image.</p>
<p>Note: despite having 800 “variables” columns,
there are only 534 rows and we cannot have more components than rows. In fact,
we should only have 533 components, but given that we did not centre the data,
we have 534.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="principal-components-analysis.html#cb32-1" tabindex="-1"></a><span class="co">#All the columns with the intensities are in the same scale so </span></span>
<span id="cb32-2"><a href="principal-components-analysis.html#cb32-2" tabindex="-1"></a><span class="co">#we do not need to scale them</span></span>
<span id="cb32-3"><a href="principal-components-analysis.html#cb32-3" tabindex="-1"></a><span class="co">#Also, we do not want to centre the columns otherwise</span></span>
<span id="cb32-4"><a href="principal-components-analysis.html#cb32-4" tabindex="-1"></a><span class="co">#the values can no longer be interpreted as intensities and </span></span>
<span id="cb32-5"><a href="principal-components-analysis.html#cb32-5" tabindex="-1"></a><span class="co">#we will not be able to plot the results</span></span>
<span id="cb32-6"><a href="principal-components-analysis.html#cb32-6" tabindex="-1"></a></span>
<span id="cb32-7"><a href="principal-components-analysis.html#cb32-7" tabindex="-1"></a><span class="co">#PCA</span></span>
<span id="cb32-8"><a href="principal-components-analysis.html#cb32-8" tabindex="-1"></a>roo.pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(roo, <span class="at">center =</span> <span class="cn">FALSE</span>) </span>
<span id="cb32-9"><a href="principal-components-analysis.html#cb32-9" tabindex="-1"></a></span>
<span id="cb32-10"><a href="principal-components-analysis.html#cb32-10" tabindex="-1"></a><span class="co">#The intensities given by the first 10 components</span></span>
<span id="cb32-11"><a href="principal-components-analysis.html#cb32-11" tabindex="-1"></a>roo.pca10 <span class="ot">&lt;-</span> roo.pca<span class="sc">$</span>x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] <span class="sc">%*%</span> <span class="fu">t</span>(roo.pca<span class="sc">$</span>rotation[,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb32-12"><a href="principal-components-analysis.html#cb32-12" tabindex="-1"></a></span>
<span id="cb32-13"><a href="principal-components-analysis.html#cb32-13" tabindex="-1"></a><span class="co">#this is just to make sure all the values</span></span>
<span id="cb32-14"><a href="principal-components-analysis.html#cb32-14" tabindex="-1"></a><span class="co">#remain within 0 and 1 (due to rounding in the</span></span>
<span id="cb32-15"><a href="principal-components-analysis.html#cb32-15" tabindex="-1"></a><span class="co">#calculation, sometimes the values go slightly higher than 1)</span></span>
<span id="cb32-16"><a href="principal-components-analysis.html#cb32-16" tabindex="-1"></a>roo.pca10[roo.pca10<span class="sc">&gt;</span><span class="dv">1</span>] <span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb32-17"><a href="principal-components-analysis.html#cb32-17" tabindex="-1"></a>roo.pca10[roo.pca10<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb32-18"><a href="principal-components-analysis.html#cb32-18" tabindex="-1"></a></span>
<span id="cb32-19"><a href="principal-components-analysis.html#cb32-19" tabindex="-1"></a><span class="co">#You can have a look at the image</span></span>
<span id="cb32-20"><a href="principal-components-analysis.html#cb32-20" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb32-21"><a href="principal-components-analysis.html#cb32-21" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span>F, <span class="at">ann=</span>F)</span>
<span id="cb32-22"><a href="principal-components-analysis.html#cb32-22" tabindex="-1"></a><span class="fu">title</span> (<span class="st">&quot;original&quot;</span>)</span>
<span id="cb32-23"><a href="principal-components-analysis.html#cb32-23" tabindex="-1"></a><span class="fu">rasterImage</span>(roo, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb32-24"><a href="principal-components-analysis.html#cb32-24" tabindex="-1"></a></span>
<span id="cb32-25"><a href="principal-components-analysis.html#cb32-25" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span>F, <span class="at">ann=</span>F)</span>
<span id="cb32-26"><a href="principal-components-analysis.html#cb32-26" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Image with 10 components from PCA&quot;</span>)</span>
<span id="cb32-27"><a href="principal-components-analysis.html#cb32-27" tabindex="-1"></a><span class="fu">rasterImage</span>(roo.pca10, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Notice that we are using only 10 of the 534 components. If we had used all the
components we would have the original image. Let’s see the image with different
number of components</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="principal-components-analysis.html#cb33-1" tabindex="-1"></a><span class="co"># Intensities with 20, 50, 100 and 534 components</span></span>
<span id="cb33-2"><a href="principal-components-analysis.html#cb33-2" tabindex="-1"></a>roo.pca.j <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">534</span>), <span class="cf">function</span>(j) {</span>
<span id="cb33-3"><a href="principal-components-analysis.html#cb33-3" tabindex="-1"></a>                      jcomp <span class="ot">&lt;-</span> roo.pca<span class="sc">$</span>x[,<span class="dv">1</span><span class="sc">:</span>j] <span class="sc">%*%</span> <span class="fu">t</span>(roo.pca<span class="sc">$</span>rotation[,<span class="dv">1</span><span class="sc">:</span>j])</span>
<span id="cb33-4"><a href="principal-components-analysis.html#cb33-4" tabindex="-1"></a>                      jcomp[jcomp<span class="sc">&gt;</span><span class="dv">1</span>] <span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb33-5"><a href="principal-components-analysis.html#cb33-5" tabindex="-1"></a>                      jcomp[jcomp<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb33-6"><a href="principal-components-analysis.html#cb33-6" tabindex="-1"></a>                      <span class="fu">return</span>(jcomp)</span>
<span id="cb33-7"><a href="principal-components-analysis.html#cb33-7" tabindex="-1"></a>                      }</span>
<span id="cb33-8"><a href="principal-components-analysis.html#cb33-8" tabindex="-1"></a>                    )</span>
<span id="cb33-9"><a href="principal-components-analysis.html#cb33-9" tabindex="-1"></a></span>
<span id="cb33-10"><a href="principal-components-analysis.html#cb33-10" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb33-11"><a href="principal-components-analysis.html#cb33-11" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span>F, <span class="at">ann=</span>F)</span>
<span id="cb33-12"><a href="principal-components-analysis.html#cb33-12" tabindex="-1"></a><span class="fu">title</span> (<span class="st">&quot;20 components&quot;</span>)</span>
<span id="cb33-13"><a href="principal-components-analysis.html#cb33-13" tabindex="-1"></a><span class="fu">rasterImage</span>(roo.pca.j[[<span class="dv">1</span>]], <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb33-14"><a href="principal-components-analysis.html#cb33-14" tabindex="-1"></a></span>
<span id="cb33-15"><a href="principal-components-analysis.html#cb33-15" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span>F, <span class="at">ann=</span>F)</span>
<span id="cb33-16"><a href="principal-components-analysis.html#cb33-16" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;50 components&quot;</span>)</span>
<span id="cb33-17"><a href="principal-components-analysis.html#cb33-17" tabindex="-1"></a><span class="fu">rasterImage</span>(roo.pca.j[[<span class="dv">2</span>]], <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb33-18"><a href="principal-components-analysis.html#cb33-18" tabindex="-1"></a></span>
<span id="cb33-19"><a href="principal-components-analysis.html#cb33-19" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span>F, <span class="at">ann=</span>F)</span>
<span id="cb33-20"><a href="principal-components-analysis.html#cb33-20" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;100 components&quot;</span>)</span>
<span id="cb33-21"><a href="principal-components-analysis.html#cb33-21" tabindex="-1"></a><span class="fu">rasterImage</span>(roo.pca.j[[<span class="dv">3</span>]], <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb33-22"><a href="principal-components-analysis.html#cb33-22" tabindex="-1"></a></span>
<span id="cb33-23"><a href="principal-components-analysis.html#cb33-23" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span>F, <span class="at">ann=</span>F)</span>
<span id="cb33-24"><a href="principal-components-analysis.html#cb33-24" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;534 components (original image&quot;</span>)</span>
<span id="cb33-25"><a href="principal-components-analysis.html#cb33-25" tabindex="-1"></a><span class="fu">rasterImage</span>(roo.pca.j[[<span class="dv">4</span>]], <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p><strong>TRY IT YOURSELF:</strong></p>
<ol style="list-style-type: decimal">
<li>Produce the image above with 100 components but using the colored photo.</li>
</ol>
<details>
<summary>
See the solution code
</summary>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="principal-components-analysis.html#cb34-1" tabindex="-1"></a>roo <span class="ot">&lt;-</span> <span class="fu">readJPEG</span>(<span class="st">&quot;roo.jpg&quot;</span>)</span>
<span id="cb34-2"><a href="principal-components-analysis.html#cb34-2" tabindex="-1"></a></span>
<span id="cb34-3"><a href="principal-components-analysis.html#cb34-3" tabindex="-1"></a><span class="co"># roo is now a list with three elements </span></span>
<span id="cb34-4"><a href="principal-components-analysis.html#cb34-4" tabindex="-1"></a><span class="co">#corresponding to the channels RBG</span></span>
<span id="cb34-5"><a href="principal-components-analysis.html#cb34-5" tabindex="-1"></a><span class="co">#we will do PCA in each element</span></span>
<span id="cb34-6"><a href="principal-components-analysis.html#cb34-6" tabindex="-1"></a>roo.rbg.pca<span class="ot">&lt;-</span> <span class="fu">apply</span>(roo, <span class="dv">3</span>, prcomp, <span class="at">center =</span> <span class="cn">FALSE</span>) </span>
<span id="cb34-7"><a href="principal-components-analysis.html#cb34-7" tabindex="-1"></a></span>
<span id="cb34-8"><a href="principal-components-analysis.html#cb34-8" tabindex="-1"></a><span class="co">#Computes the intensities using 100 components</span></span>
<span id="cb34-9"><a href="principal-components-analysis.html#cb34-9" tabindex="-1"></a>roo.pca2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(roo.rbg.pca, <span class="cf">function</span>(channel.pca) {</span>
<span id="cb34-10"><a href="principal-components-analysis.html#cb34-10" tabindex="-1"></a>                      jcomp <span class="ot">&lt;-</span> channel.pca<span class="sc">$</span>x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="sc">%*%</span> <span class="fu">t</span>(channel.pca<span class="sc">$</span>rotation[,<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>])</span>
<span id="cb34-11"><a href="principal-components-analysis.html#cb34-11" tabindex="-1"></a>                      jcomp[jcomp<span class="sc">&gt;</span><span class="dv">1</span>] <span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb34-12"><a href="principal-components-analysis.html#cb34-12" tabindex="-1"></a>                      jcomp[jcomp<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb34-13"><a href="principal-components-analysis.html#cb34-13" tabindex="-1"></a>                      <span class="fu">return</span>(jcomp)})</span>
<span id="cb34-14"><a href="principal-components-analysis.html#cb34-14" tabindex="-1"></a></span>
<span id="cb34-15"><a href="principal-components-analysis.html#cb34-15" tabindex="-1"></a><span class="co">#Transforms the above list into an array</span></span>
<span id="cb34-16"><a href="principal-components-analysis.html#cb34-16" tabindex="-1"></a>roo.pca2<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="fu">as.numeric</span>(<span class="fu">unlist</span>(roo.pca2)), </span>
<span id="cb34-17"><a href="principal-components-analysis.html#cb34-17" tabindex="-1"></a>               <span class="at">dim=</span><span class="fu">c</span>(<span class="dv">534</span>, <span class="dv">800</span>, <span class="dv">3</span>))</span>
<span id="cb34-18"><a href="principal-components-analysis.html#cb34-18" tabindex="-1"></a></span>
<span id="cb34-19"><a href="principal-components-analysis.html#cb34-19" tabindex="-1"></a></span>
<span id="cb34-20"><a href="principal-components-analysis.html#cb34-20" tabindex="-1"></a><span class="co">#You can have a look at the image</span></span>
<span id="cb34-21"><a href="principal-components-analysis.html#cb34-21" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb34-22"><a href="principal-components-analysis.html#cb34-22" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span>F, <span class="at">ann=</span>F)</span>
<span id="cb34-23"><a href="principal-components-analysis.html#cb34-23" tabindex="-1"></a><span class="fu">title</span> (<span class="st">&quot;original&quot;</span>)</span>
<span id="cb34-24"><a href="principal-components-analysis.html#cb34-24" tabindex="-1"></a><span class="fu">rasterImage</span>(roo, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb34-25"><a href="principal-components-analysis.html#cb34-25" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span>F, <span class="at">ann=</span>F)</span>
<span id="cb34-26"><a href="principal-components-analysis.html#cb34-26" tabindex="-1"></a><span class="fu">title</span> (<span class="st">&quot;100 components&quot;</span>)</span>
<span id="cb34-27"><a href="principal-components-analysis.html#cb34-27" tabindex="-1"></a><span class="fu">rasterImage</span>(roo.pca2, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</details>
<p>
<p>
</div>
</div>
<div id="PCA4" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Exercises<a href="principal-components-analysis.html#PCA4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Solve the following exercises:</p>
<ol style="list-style-type: decimal">
<li>The dataset <em>fat</em> is available in the <em>library(faraway)</em>.
The dataset contains several physical measurements.</li>
</ol>
<p>Using the variables <em>age</em>, <em>weight</em>, <em>height</em>, <em>adipos</em>, <em>free</em>, <em>neck</em>, <em>chest</em>,
<em>abdom</em>, <em>hip</em>, <em>thigh</em>, <em>knee</em>, <em>ankle</em>, <em>biceps</em>, <em>forearm</em> and <em>wrist</em></p>
<ol style="list-style-type: lower-alpha">
<li><p>How many components explain at least 95% of the variance?</p></li>
<li><p>Identify 2 variable that seem to have a stronger contribution to the 2nd
principal component.</p></li>
<li><p>Compare the adjusted-<span class="math inline">\(r^2\)</span> for a linear model for <strong>brozek</strong> using all
the predictors and a linear model only using 2 principal components to predict
<strong>brozek</strong>.</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="k-means-clustering.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": null,
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
